name = "ftops"
compatibility_date = "2026-01-01"
main = "src/index.ts"
workers_dev = false

[dev]
inspector_port = 9230
port = 8787

# D1 database binding
[[d1_databases]]
binding = "DB"
database_name = "ftops-db"
database_id = "0df8f7bd-69a2-460d-809f-f92a3c634ea6"

migrations_dir = "migrations"
migrations_table = "d1_migrations"

# Queue producer (HTTP → queue)
[[queues.producers]]
binding = "EVENT_QUEUE"
queue = "ftops-events"

# Queue consumer (queue → processing)
[[queues.consumers]]
queue = "ftops-events"

[[queues.consumers]]
queue = "events-qb-ingest"

[[queues.consumers]]
queue = "events-shopify-ingest"

[[r2_buckets]]
binding = "R2_TASK_FILES_BUCKET"
bucket_name = "ftops-task-files"

[observability]
[observability.logs]
enabled = true
invocation_logs = true

[vars]
INTEGRATIONS_KEY_ID = "v1"
# Set true for dev-only direct upload fallback (no presigned URLs).
ALLOW_R2_FALLBACK_UPLOADS = "false"
R2_TASK_FILES_BUCKET_NAME = "ftops-task-files"
# Optional public host for R2 (e.g. opsfiles.from-trees.com)
R2_TASK_FILES_PUBLIC_HOST = "opsfiles.from-trees.com"
# R2_ACCOUNT_ID should be set per environment (see Cloudflare dashboard)
R2_ACCOUNT_ID = "125d8016e23830dcaf86de127ce90576"
# INTEGRATIONS_MASTER_KEY should be set via `wrangler secret` or .dev.vars
